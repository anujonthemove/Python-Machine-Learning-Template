# --------------------------------------------------------------------------------
# Author: Anuj Khandelwal
# Date: 2023-07-01
# Credits: https://github.com/orgs/community/discussions/22183#discussioncomment-4585507
# Description:
# This workflow is used for the first time setup of the repository. It is triggered
# when you create a new repository using this template.
# The workflow removes unwanted files and folders from your project.
# It also clears up the README for the user. It only runs once when the
# repository is generated.
# --------------------------------------------------------------------------------

name: Repository-Cleanup
run-name: Clean up repository

on:
  # run when branch created (repo generated from template)
  create:

# only keep latest run of this workflow
concurrency:
  group: Repository-Cleanup
  cancel-in-progress: true

permissions:
  # give all permissions
  actions: write
  checks: write
  contents: write
  deployments: write
  issues: write
  packages: write
  pull-requests: write
  repository-projects: write
  security-events: write
  statuses: write

jobs:
  Repository-Cleanup:
    # ensure run only once, when repo generated
    if: github.run_number == 1

    runs-on: ubuntu-latest

    steps:
      # get main branch repository contents
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # remove unwanted folders
      - name: Remove .assets folder
        run: rm -rf .assets

      # remove unwanted files
      - name: Remove unneeded files
        run: rm -f README.md FUNDING.yml

      # personalize readme for user
      - name: Init readme
        run: |
          echo "

          # ${{ github.event.repository.name }}

          " > README.md

      # save changed files
      - name: Commit changed files
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Initial commit"
        env:
          GITHUB_TOKEN: ${{ github.token }}
